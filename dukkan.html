<!DOCTYPE html>
<html lang="tr">
<head>
<link rel="icon" type="image/png" href="site.png">    
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Arasta</title>
<style>
body { margin:0; padding:0; background:#2a1e12; font-family:'Georgia', serif; color:#f8e7c3; overflow-x:hidden; }
.header { text-align:center; font-size:48px; padding:20px; background:linear-gradient(#3d2a1a, #27190d); border-bottom:4px solid #a67c2e; text-shadow:0 0 10px #000; position:relative; }
.back-btn { position:absolute; left:20px; top:20px; background:#a67c2e; padding:10px 18px; border-radius:10px; cursor:pointer; font-size:18px; color:#fff; border:2px solid #704f1d; }

.category { width:95%; margin:20px auto; padding:20px; border:4px solid #a67c2e; border-radius:20px; background:#3a2818; box-shadow:0 0 20px #000; }
.category h2 { text-align:center; margin-bottom:20px; font-size:36px; }
.items { display:flex; justify-content:center; gap:30px; flex-wrap:wrap; }

.item { width:260px; height:400px; background:#4b3420; border:4px solid #a67c2e; border-radius:16px; box-shadow:0 0 10px #000; display:flex; flex-direction:column; justify-content:space-between; padding:10px; transition:0.2s; }
.item:hover { transform:scale(1.07); box-shadow:0 0 20px #000; }
.item img { width:100%; height:220px; object-fit:contain; background:rgba(255,255,255,0.05); border-radius:10px; }
.item-name { text-align:center; margin-top:5px; font-weight:bold; font-size:18px; }
.btn { background:#a67c2e; padding:12px; border-radius:10px; cursor:pointer; text-align:center; border:2px solid #704f1d; font-size:20px; margin-top:5px; }
.btn.disabled { background:#555; pointer-events:none; color:#ddd; }

.inventory-popup { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); width:700px; background:#3a2818; border:4px solid #a67c2e; border-radius:20px; box-shadow:0 0 20px #000; padding:20px; display:none; z-index:999; }
.inventory-popup h2 { text-align:center; margin-bottom:20px; }
.close-btn { background:#000; margin-top:30px; padding:12px; text-align:center; border-radius:12px; cursor:pointer; border:2px solid #a67c2e; font-size:20px; display:block; }
.inventory-items { display:flex; flex-direction:column; gap:10px; font-size:18px; margin-bottom:20px; max-height:320px; overflow:auto; }

.open-inventory { position:fixed; right:20px; top:20px; background:#a67c2e; padding:12px 20px; border-radius:12px; border:2px solid #704f1d; cursor:pointer; font-size:20px; z-index:900; }

.balance-box { position:fixed; left:20px; top:80px; font-size:22px; background:linear-gradient(to bottom, #f9d976, #f39f86); color:#4b2e1a; font-weight:bold; padding:10px 16px; border:3px solid #a67c2e; border-radius:12px; box-shadow:0 0 15px #000; z-index:950; text-shadow:1px 1px 2px #000; }

.select-btn { margin-top:8px; padding:8px; border-radius:8px; border:2px solid #704f1d; background:#a67c2e; cursor:pointer; font-size:16px; text-align:center; transition:0.2s; display:inline-block; min-width:90px; }
.select-btn.selected { background:#555; color:#f8e7c3; pointer-events:none; transform:scale(1.02); }

#noMoneyPopup { position:fixed; top:40%; left:50%; transform:translate(-50%,-50%); background:#5b0000; border:4px solid #a67c2e; padding:25px 40px; border-radius:20px; box-shadow:0 0 30px #000; text-align:center; font-size:24px; display:none; z-index:2000; color:#ff4c4c; font-weight:bold; text-shadow:2px 2px 4px #000; animation:popupAnim 0.5s; }
#firstPurchasePopup { position:fixed; top:30%; left:50%; transform:translate(-50%,-50%); background:#3a0d0d; border:4px solid #a67c2e; padding:20px 30px; border-radius:20px; box-shadow:0 0 30px #000; text-align:center; font-size:20px; display:none; z-index:2000; color:#ffd700; font-weight:bold; text-shadow:2px 2px 4px #000; animation:popupAnim 0.5s; }

@keyframes popupAnim { 0% { transform:translate(-50%, -60%) scale(0.5); opacity:0; } 100% { transform:translate(-50%, -50%) scale(1); opacity:1; } }

/* Hile panel */
#cheatPanel {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #222;
    padding: 18px;
    border-radius: 10px;
    color: white;
    display: none;
    z-index: 99999;
    width: 320px;
    text-align: center;
    box-shadow: 0 0 15px rgba(0,0,0,0.6);
}
#cheatPanel input {
    width: 92%;
    padding: 8px;
    margin-top: 10px;
    border-radius: 6px;
    border: none;
    background:#111;
    color:#fff;
}
#cheatPanel button {
    margin-top: 10px;
    padding: 8px 14px;
    border: none;
    border-radius: 6px;
    background: #4CAF50;
    color: white;
    cursor: pointer;
}
</style>
</head>
<body>
<div class="header"><div class="back-btn">Geri Dön</div>Arasta</div>
<div class="open-inventory">Depo</div>
<div class="balance-box">Bakiye: <span id="balanceText">0</span> akçe</div>

<!-- Kategoriler -->
<div class="category" id="tas">
    <h2>Taş Görünümü</h2>
    <div class="items">
        <div class="item" data-id="tas_1" data-name="Acemi Taşı" data-category="tas">
            <img src="https://i.imgur.com/YWjEcKs.png" alt="Acemi Taşı">
            <div class="item-name">Acemi Taşı</div>
            <div class="btn" data-price="80">Satın Al (80)</div>
        </div>
        <div class="item" data-id="tas_2" data-name="Deneyim Taşı" data-category="tas">
            <img src="https://i.imgur.com/E9iEyZk.png" alt="Deneyim Taşı">
            <div class="item-name">Deneyim Taşı</div>
            <div class="btn" data-price="100">Satın Al (100)</div>
        </div>
        <div class="item" data-id="tas_3" data-name="Usta Taşı" data-category="tas">
            <img src="https://i.imgur.com/Zt07iVr.png" alt="Usta Taşı">
            <div class="item-name">Usta Taşı</div>
            <div class="btn" data-price="120">Satın Al (120)</div>
        </div>
    </div>
</div>

<div class="category" id="tahta">
    <h2>Tahta Görünümü</h2>
    <div class="items">
        <div class="item" data-id="tahta_1" data-name="Lonca Tahtası" data-category="tahta">
            <img src="https://i.imgur.com/R6vpPoC.png" alt="Lonca Tahtası">
            <div class="item-name">Lonca Tahtası</div>
            <div class="btn" data-price="45">Satın Al (45)</div>
        </div>
        <div class="item" data-id="tahta_2" data-name="Kardeşlik Tahtası" data-category="tahta">
            <img src="https://i.imgur.com/c0h84vg.png" alt="Kardeşlik Tahtası">
            <div class="item-name">Kardeşlik Tahtası</div>
            <div class="btn" data-price="60">Satın Al (60)</div>
        </div>
        <div class="item" data-id="tahta_3" data-name="Hikmet Tahtası" data-category="tahta">
            <img src="https://i.imgur.com/uh6EpbU.png" alt="Hikmet Tahtası">
            <div class="item-name">Hikmet Tahtası</div>
            <div class="btn" data-price="90">Satın Al (90)</div>
        </div>
    </div>
</div>

<div class="category" id="muzik">
    <h2>Müzikler</h2>
    <div class="items">
        <div class="item" data-id="muzik_1" data-name="Zanaat Rüyası" data-category="muzik">
            <img src="https://i.imgur.com/1xSJ89f.png" alt="Zanaat Rüyası">
            <div class="item-name">Zanaat Rüyası</div>
            <div class="btn" data-price="100">Satın Al (100)</div>
        </div>
        <div class="item" data-id="muzik_2" data-name="Bedesten Notaları" data-category="muzik">
            <img src="https://i.imgur.com/1xSJ89f.png" alt="Bedesten Notaları">
            <div class="item-name">Bedesten Notaları</div>
            <div class="btn" data-price="150">Satın Al (150)</div>
        </div>
        <div class="item" data-id="muzik_3" data-name="Ahde Vefa" data-category="muzik">
            <img src="https://i.imgur.com/1xSJ89f.png" alt="Ahde Vefa">
            <div class="item-name">Ahde Vefa</div>
            <div class="btn" data-price="220">Satın Al (220)</div>
        </div>
    </div>
</div>

<div id="noMoneyPopup">Yetersiz Bakiye!</div>
<div id="firstPurchasePopup">İlk ürünü satın aldınız! Depoya gidip seçebilirsiniz.</div>

<!-- Depo -->
<div class="inventory-popup" id="inventoryPopup">
    <h2>Depo</h2>
    <div style="display:flex;gap:10px;margin-bottom:15px;">
        <div class="invTab" data-tab="tas" style="padding:10px;background:#a67c2e;border-radius:10px;cursor:pointer;">Taş</div>
        <div class="invTab" data-tab="tahta" style="padding:10px;background:#a67c2e;border-radius:10px;cursor:pointer;">Tahta</div>
        <div class="invTab" data-tab="muzik" style="padding:10px;background:#a67c2e;border-radius:10px;cursor:pointer;">Müzik</div>
    </div>
    <div class="inventory-items" id="inventoryList"></div>
    <div class="close-btn" id="closeInv">Kapat</div>
</div>

<!-- Hile panel (F9) -->
<div id="cheatPanel">
    <h3>Gizli Kod</h3>
    <input id="cheatInput" placeholder="">
    <br>
    <button id="cheatApply">Uygula</button>
    <button id="cheatClose" style="margin-left:8px;background:#c0392b">Kapat</button>
</div>

<script>
/* ====== Temel: aktif kullanıcı (kayıt.html ile set ediliyor) ====== */
const activeUser = localStorage.getItem("activeUser");
if(!activeUser){
    alert("Lütfen giriş yapınız!");
    window.location.href = "kayıt.html";
}

// Kullanıcıya özel anahtarlar
const balanceKey = "balance_" + activeUser; // bazı yerlerde coins_ ya da userData.coins vardı, biz balance_ kullanıyoruz
const inventoryKey = "inventory_" + activeUser;
const firstPurchaseKey = "firstPurchase_" + activeUser;

// İlk yükleme: eksik anahtarları başlat
if(localStorage.getItem(balanceKey) === null){
    // Eğer user_... objesinde coins değeri varsa onu kullanalım, yoksa 0
    const storedUser = localStorage.getItem("user_" + activeUser);
    let startCoins = 0;
    if(storedUser){
        try{ startCoins = JSON.parse(storedUser).coins || 0; }catch(e){ startCoins = 0;}
    }
    localStorage.setItem(balanceKey, startCoins);
}
if(localStorage.getItem(inventoryKey) === null){
    localStorage.setItem(inventoryKey, JSON.stringify([]));
}
if(localStorage.getItem(firstPurchaseKey) === null){
    localStorage.setItem(firstPurchaseKey, "false");
}

// Kısa yardımcı fonksiyonlar
function getBalance(){ return Number(localStorage.getItem(balanceKey) || 0); }
function setBalance(v){ localStorage.setItem(balanceKey, Number(v)); updateBalanceUI(); }
function getInventory(){ try{ return JSON.parse(localStorage.getItem(inventoryKey)) || []; }catch(e){ return []; } }
function setInventory(arr){ localStorage.setItem(inventoryKey, JSON.stringify(arr)); }
function getFirstPurchase(){ return localStorage.getItem(firstPurchaseKey) === 'true'; }
function setFirstPurchase(b){ localStorage.setItem(firstPurchaseKey, b ? 'true' : 'false'); }

/* ====== UI Güncellemeleri ====== */
const balanceText = document.getElementById('balanceText');
function updateBalanceUI(){
    balanceText.textContent = getBalance();
}

/* Satın alınan ürünleri sayfa yüklendiğinde butonlara uygula */
function markPurchasedButtons(){
    const inv = getInventory();
    document.querySelectorAll('.item').forEach(box=>{
        const id = box.dataset.id;
        const btn = box.querySelector('.btn');
        if(inv.some(i => i.id === id)){
            btn.textContent = 'Satın Alındı';
            btn.classList.add('disabled');
            btn.setAttribute('disabled', 'true');
        } else {
            btn.textContent = 'Satın Al (' + btn.dataset.price + ')';
            btn.classList.remove('disabled');
            btn.removeAttribute('disabled');
        }
    });
}

/* ====== Satın alma işlemi ====== */
document.querySelectorAll('.btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
        const box = btn.parentElement;
        const id = box.dataset.id;
        const name = box.dataset.name;
        const cat = box.dataset.category;
        const price = parseInt(btn.dataset.price, 10);

        let inv = getInventory();
        if(inv.some(i => i.id === id)) return; // zaten alınmış

        let bal = getBalance();
        if(bal < price){
            const pop = document.getElementById('noMoneyPopup');
            pop.style.display = 'block';
            setTimeout(()=> pop.style.display = 'none', 1600);
            return;
        }

        bal -= price;
        setBalance(bal);

        // Ürünü inventory'ye ekle
        inv.push({ id, name, category: cat, price: price, selected: false });
        setInventory(inv);

        // İlk satınalma kontrolü
        if(!getFirstPurchase()){
            setFirstPurchase(true);
            const fp = document.getElementById('firstPurchasePopup');
            fp.style.display = 'block';
            setTimeout(()=> fp.style.display = 'none', 2800);
        }

        // Butonu güncelle
        btn.textContent = 'Satın Alındı';
        btn.classList.add('disabled');
        btn.setAttribute('disabled', 'true');
    });
});

/* ====== Depo (inventory) ====== */
const invPopup = document.getElementById('inventoryPopup');
const invList = document.getElementById('inventoryList');
document.querySelector('.open-inventory').onclick = ()=>{
    loadInventoryTab('tas');
    invPopup.style.display = 'block';
};
document.getElementById('closeInv').onclick = ()=> invPopup.style.display = 'none';

function loadInventoryTab(tab){
    const filtered = getInventory().filter(i => i.category === tab);
    if(filtered.length === 0){
        invList.innerHTML = '<div style="padding:10px;">Bu kategoride ürün yok.</div>';
        return;
    }

    invList.innerHTML = filtered.map(item => `
        <div style="display:flex;align-items:center;justify-content:space-between;padding:8px 6px;border-bottom:1px solid rgba(0,0,0,0.2);">
            <div>
                <div style="font-weight:700;">${item.name}</div>
                <div style="font-size:13px;color:#e0d2b0;">${item.price} akçe</div>
            </div>
            <div>
                <div class="select-btn ${item.selected ? 'selected' : ''}" data-id="${item.id}" data-cat="${item.category}">
                    ${item.selected ? 'Seçildi' : 'Seç'}
                </div>
            </div>
        </div>
    `).join('');
    // attach click handlers
    document.querySelectorAll('.select-btn').forEach(b=>{
        b.onclick = ()=>{
            const id = b.dataset.id;
            const cat = b.dataset.cat;
            let inv = getInventory();
            // tüm aynı kategoridekileri unselect et
            inv.filter(x => x.category === cat).forEach(x => x.selected = false);
            const sel = inv.find(x => x.id === id);
            if(sel) sel.selected = true;
            setInventory(inv);
            loadInventoryTab(cat); // yeniden render
            markPurchasedButtons(); // eğer item seçimi oyun tarafında görünümü etkiliyorsa güncelle
        };
    });
}

/* inv tab butonları */
document.querySelectorAll('.invTab').forEach(t=>{
    t.addEventListener('click', ()=> loadInventoryTab(t.dataset.tab));
});

/* ====== Geri dön butonu ====== */
document.querySelector('.back-btn').addEventListener('click', () => {
    // istersen burada activeUser'ı saklama/kaldırma davranışı ekleyebilirsin
    window.location.href = 'anamenu.html';
});

/* ====== Hile paneli (F9) ====== */
// Ctrl+O'yu engelle (istenmeyen dosya açma)
document.addEventListener('keydown', function(e){
    if(e.ctrlKey && (e.key === 'o' || e.key === 'O')) {
        e.preventDefault();
    }
    if(e.key === 'F9'){
        const panel = document.getElementById('cheatPanel');
        panel.style.display = (panel.style.display === 'block') ? 'none' : 'block';
        document.getElementById('cheatInput').value = '';
    }
});

// Hile apply: gizli kodu prompt veya input ile eşle
document.getElementById('cheatApply').addEventListener('click', ()=>{
    const code = document.getElementById('cheatInput').value.trim();
    // Burada hile kodunu sen seçebilirsin, örnek 'GIZLI1000'
    if(code === 'GIZLI1000'){
        const newBal = getBalance() + 1000;
        setBalance(newBal);
        alert('✔ 1000 akçe eklendi (gizli).');
        document.getElementById('cheatPanel').style.display = 'none';
        markPurchasedButtons();
    } else {
        alert('Geçersiz kod.');
    }
});
document.getElementById('cheatClose').addEventListener('click', ()=>{
    document.getElementById('cheatPanel').style.display = 'none';
});

/* ====== Başlangıç (load) ====== */
window.addEventListener('DOMContentLoaded', ()=>{
    updateBalanceUI();
    markPurchasedButtons();
});

// Eğer inventory/local balance başka sayfalarda güncelleniyorsa sayfa odaklandığında yenile
window.addEventListener('focus', ()=>{
    updateBalanceUI();
    markPurchasedButtons();
});
</script>
</body>
</html>
